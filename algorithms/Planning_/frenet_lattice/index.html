<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>Frenet Optimal Trajectory - 代理仿真文档</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../../extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Frenet Optimal Trajectory";
        var mkdocs_page_input_path = "algorithms\\Planning_\\frenet_lattice.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> 代理仿真文档
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">首页</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">代理仿真文档</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Frenet Optimal Trajectory</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/OpenHUTB/carla_doc/edit/master/docs/algorithms/Planning_/frenet_lattice.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="frenet_lattice">frenet_lattice</h1>
<!-- lqz27, lirj19 -->

<p>The frenet_lattice planner is a lattice <strong>local planner</strong> that implements the trajectory  generation algorithm proposed in the paper <a href="https://fileadmin.cs.lth.se/ai/Proceedings/ICRA2010/MainConference/data/papers/1650.pdf"><em>Optimal Trajectory Generation for Dynamic Street Scenarios in a Frenét Frame</em></a>. 
In the frenet_lattice planner, you can just use <a href="https://github.com/CAS-LRJ/ISS/blob/main/ISS/algorithms/planning/local_planner/lattice_planner.py">LatticePlanner.run_step</a> to get trajectory with inputs, such as current Cartesian state, etc.</p>
<h2 id="inputs">Inputs</h2>
<p>The inputs of frenet_lattice planner can come from the Carla simulator or from physical environments; 
they include several types of data, such as</p>
<ul>
<li>a <strong>map</strong> providing the road network related information to the frenet_lattice planner such as the lane width of the different roads, traffic light positions, standard speed limits, etc. The most common types of maps are: lanelet, OpenDRIVE, etc.;</li>
<li>the <strong>path</strong> generated by the global <a href="index.html#route">route planner</a>, providing a reference course leading to the desired destination;</li>
<li>some <strong>obstacle information</strong> about obstacles on the current road, such as their position, yaw, bounding box, etc.;</li>
<li>the <strong>decision</strong> generated by <a href="index.html#behavior">behavior planner</a> on how to control the vehicle, such as the velocity to keep, Following, Merging, Stopping, etc.</li>
</ul>
<h2 id="outputs">Outputs</h2>
<p>The output of frenet_lattice is a trajectory which contains position and speed of the vehicle. Such a trajectory must be dynamically feasible for the vehicle, comfortable for the passenger, and avoid collisions with obstacles detected by the on-board sensors. In practice, the output consists of </p>
<ul>
<li>the <strong>trajectory</strong> to follow, including information about speed, position, and its cost.</li>
</ul>
<h2 id="frenetpath-class">FrenetPath <a name="FrenetPath"></a> (<em>class</em>)</h2>
<p>Store the trajectories(paths) which are generated by frenet_lattice planner. This class not only contain Frenet coordinate <code>[s, s_d, s_dd, s_ddd, d, d_dd, d_ddd]</code> and Cartesian coordinate <code>[x, y, yaw, ds, c]</code>, but also cost of trajectory.</p>
<h3 id="instance-variables">Instance Variables</h3>
<ul>
<li><a name="FrenetPath.t"></a><strong><font color="#f8805a">t</font></strong> (<em>list(float <small>- seconds</small>)</em>)<br />
   Time of each Frenet point in Frenet path.</li>
<li><a name="FrenetPath.s"></a><strong><font color="#f8805a">s</font></strong> (<em>list(float <small>- meters</small>)</em>)<br />
   Frenet longitudinal movement. Also represents the arc length, indicates the distance a vehicle has traveled along the road centerline. The value of s can be used to denote the vehicle's position.</li>
<li><a name="FrenetPath.d"></a><strong><font color="#f8805a">d</font></strong> (<em>list(float <small>- meters</small>)</em>)<br />
   Frenet lateral offset. Indicates the lateral distance of the vehicle relative to the road centerline. The value of <em>d</em> can be used to represent the vehicle's lateral position. A positive value indicates the vehicle is on the right side of the road, while a negative value indicates the left side.</li>
<li><a name="FrenetPath.s_d"></a><strong><font color="#f8805a">s_d</font></strong> (<em>list(float <small>- m/s</small>)</em>)<br />
   Frenet longitudinal velocity. Indicates the speed of the vehicle in the direction along the road centerline.</li>
<li><a name="FrenetPath.d_d"></a><strong><font color="#f8805a">d_d</font></strong> (<em>list(float <small>- m/s</small>)</em>)<br />
   Frenet longitudinal velocity.Represents the derivative of lateral offset <em>d</em> with respect to time. It denotes the rate of change of lateral offset, indicating how rapidly the vehicle is changing its lateral position. </li>
<li><a name="FrenetPath.s_dd"></a><strong><font color="#f8805a">s_dd</font></strong> (<em>list(float <small>- m/s<sup>2</sup></small>)</em>)<br />
   Frenet longitudinal acceleration. Represents the rate of change of longitudinal velocity. It quantifies how quickly the vehicle is speeding up or slowing down along the road.</li>
<li><a name="FrenetPath.d_dd"></a><strong><font color="#f8805a">d_dd</font></strong> (<em>list(float <small>- m/s<sup>2</sup></small>)</em>)<br />
   Frenet lateral acceleration.Represents the rate of change of lateral velocity. It quantifies how quickly the lateral speed of the vehicle changes over time.</li>
<li><a name="FrenetPath.s_ddd"></a><strong><font color="#f8805a">s_ddd</font></strong> (<em>list(float <small>- m/s<sup>3</sup></small>)</em>)<br />
   Frenet longitudinal jerk. Represents the rate of change of longitudinal acceleration. It is related to driving comfort.</li>
<li><a name="FrenetPath.d_ddd"></a><strong><font color="#f8805a">d_ddd</font></strong> (<em>list(float <small>- m/s<sup>3</sup></small>)</em>)<br />
   Frenet lateral jerk.Represents the rate of change of lateral acceleration. It is related to driving comfort.</li>
<li><a name="FrenetPath.x"></a><strong><font color="#f8805a">x</font></strong> (<em>list(float <small>- seconds</small>)</em>)<br />
   Cartesian horizontal coordinate x-axis. It measures the horizontal distance of an object relative to a coordinate origin point. </li>
<li><a name="FrenetPath.y"></a><strong><font color="#f8805a">y</font></strong> (<em>list(float <small>- meters</small>)</em>)<br />
   Cartesian vertical coordinate y-axis. It measures the vertical distance of an object relative to a coordinate origin point. </li>
<li><a name="FrenetPath.yaw"></a><strong><font color="#f8805a">yaw</font></strong> (<em>list(float <small>- radians</small>)</em>)<br />
   Cartesian yaw angle. It is the orientation angle of the object.</li>
<li><a name="FrenetPath.ds"></a><strong><font color="#f8805a">ds</font></strong> (<em>list(float <small>- meters</small>)</em>)<br />
   Cartesian arc length. It is the distance between two trajectories' points.</li>
<li><a name="FrenetPath.c"></a><strong><font color="#f8805a">c</font></strong> (<em>list(float <small>- 1/radian</small>)</em>)<br />
   Cartesian curvature. It describes the degree of curvature of trajectories.</li>
<li><a name="FrenetPath.cv"></a><strong><font color="#f8805a">cv</font></strong> (<em>float</em>)
   Frenet longitudinal s(velocity) Cost of this trajectory. Initial with zero.</li>
<li><a name="FrenetPath.cd"></a><strong><font color="#f8805a">cd</font></strong> (<em>float</em>) <br />
   Frenet lateral d Cost of this trajectory. Initial with zero.</li>
<li><a name="FrenetPath.cf"></a><strong><font color="#f8805a">cf</font></strong> (<em>float</em>) <br />
   Final Cost of this trajectory. It is the sum of longitudinal and lateral Cost. Initial with zero.</li>
</ul>
<h2 id="latticeplanner-class">LatticePlanner <a name="LatticePlanner"></a> (<em>class</em>)</h2>
<p>LatticePlanner is a local planner which generate the best trajectory, so called  FrenetPath with inputs, including map, global waypoints, etc. </p>
<h3 id="instance-variables_1">Instance Variables</h3>
<ul>
<li><a name="LatticePlanner.route_graph"></a><strong><font color="#f8805a">route_graph</font></strong> (<em>DataType=Unkown</em>) <br />
   A graph that represents the road network based on a lanelet map and traffic rules. In FrenetPlanner, it's used to get left/right lane for lateral planning.</li>
<li><a name="LatticePlanner.waypoints_xy"></a><strong><font color="#f8805a">waypoints_xy</font></strong> (<em>list(list(float,float))</em>) <br />
   The list of xy coordinate which is the outputs of global planner which is so called global waypoints.  <br />
   For instance, <strong><span style="color:#ADD8E6">[[x<sub>0</sub>, y<sub>0</sub>], [x<sub>1</sub>, y<sub>1</sub>], ...]</span></strong>.</li>
<li><a name="LatticePlanner.state_cartesian"></a><strong><font color="#f8805a">state_cartesian</font></strong> (<em>list</em>) <br />
   Current cartesian state, defined as <strong><span style="color:#ADD8E6"> [x, y, yaw, v, a]</span></strong>, where x y is xy coordinates, yaw refers to rotation around the vertical axis, v is velocity, a is acceleration. state_cartesian is measured in <em><small>[meters, meters, radians, m/s, m/s<sup>2</sup>]</small></em>.</li>
<li><a name="LatticePlanner.state_frenet"></a><strong><font color="#f8805a">state_frenet</font></strong> (<em>list</em>) <br />
   Current frenet state, defined as  <strong><span style="color:#ADD8E6">[s, s_d, s_dd, d, d_d, d_dd]</span></strong>. Where, s s_d and s_dd represents Frenet longitudinal coordinate velocity and acceleration, d, d_d and d_dd represents lateral coordinate velocity and acceleration. state_frenet is measured in <em><small>[meters, m/s, m/s<sup>2</sup>, meters, m/s, m/s<sup>2</sup>]</small></em>.</li>
<li><a name="LatticePlanner.best_path"></a><strong><font color="#f8805a">best_path</font></strong> (<em>FrenetPath</em>) <br />
   The best trajectory(path) of FrenetPlanner based on current state_frenet.</li>
<li><a name="LatticePlanner.road_detector"></a><strong><font color="#f8805a">road_detector</font></strong> (<em>Sensor</em>) <br />
   Detect road. Return road line position.</li>
<li><a name="LatticePlanner.obstacle_detector"></a><strong><font color="#f8805a">obstacle_detector</font></strong> (<em>Sensor</em>) <br />
   Detect obstacle. Return <b> True </b> when obstacle is nearby the trajectory.</li>
</ul>
<h3 id="methods">Methods</h3>
<ul>
<li><a name="LatticePlanner._generate_target_course"></a><strong><font color="#7fb800">_generate_target_course</font></strong>(<font color="#00a6ed"><strong>self</strong></font>)<br />
Generates smooth reference line based on global waypoints by using <strong><span style="color:#ADD8E6">cubic spline</span></strong>. </li>
<li><strong>Return:</strong> <em><a href="#FrenetPath.x">rx</a></em>, <em><a href="#FrenetPath.y">ry</a></em>, <em><a href="#FrenetPath.yaw">ryaw</a></em>, <em><a href="#FrenetPath.c">rk</a></em>, <em><a href="#Spline2D">csp</a></em></li>
<li><a name="LatticePlanner._calc_frenet_paths"></a><strong><font color="#7fb800">_calc_frenet_paths</font></strong>(<font color="#00a6ed"><strong>self</strong></font>)<br />
Generates all <strong>frenet paths</strong> which just contain Frenet coordinate and cost but not Cartesian coordinate by sampling time <em><code>Ti</code></em>,  lateral d <em><code>lat_qp</code></em> and longitudinal s <em><code>lon_qp</code></em>.</li>
<li><strong>Return:</strong> <em><a href="#FrenetPath">frenet_paths</a></em> (<em>list(FrenetPath)</em>)</li>
<li><a name="LatticePlanner._calc_global_paths"></a><strong><font color="#7fb800">_calc_frenet_paths</font></strong>(<font color="#00a6ed"><strong>self</strong></font>, <font color="#00a6ed"><strong>fplist</strong></font>)<br />
Gets Cartesian coordinate of frenet_paths.</li>
<li><strong>Parameters:</strong><ul>
<li><code>fplist</code> (<em>list(FrenetPath)</em>) - <strong>frenet paths</strong> which just contain Frenet coordinate and cost but not Cartesian coordinate.  </li>
</ul>
</li>
<li><strong>Return:</strong> <em><a href="#FrenetPath">filtered_fplist</a></em> (<em>list(FrenetPath)</em>) - which contain Cartesian coordinate, Frenet coordinate and cost.</li>
<li><a name="LatticePlanner._check_paths"></a><strong><font color="#7fb800">_check_paths</font></strong>(<font color="#00a6ed"><strong>self</strong></font>, <font color="#00a6ed"><strong>fplist</strong></font>)<br />
Gets comfortable, kinematically feasible trajectories.</li>
<li><strong>Parameters:</strong><ul>
<li><code>fplist</code> (<em>list(FrenetPath)</em>) - <strong>frenet paths</strong> which contain Cartesian coordinate, Frenet coordinate and cost.</li>
</ul>
</li>
<li><strong>Return:</strong> <em><a href="#FrenetPath">fplist</a></em>(<em>list(FrenetPath)</em>) - which is comfortable and kinematically feasible.</li>
<li><a name="LatticePlanner.frenet_optimal_planning"></a><strong><font color="#7fb800">frenet_optimal_planning</font></strong>(<font color="#00a6ed"><strong>self</strong></font>)<br />
Gets best trajectory. First generates all trajectories which is not containing Cartesian coordinate by using methods <span style="color:#ADD8E6">LatticePlanner._generate_target_course</span>. Then gets Cartesian coordinate trajectories by using method <span style="color:#ADD8E6">LatticePlanner._calc_frenet_paths</span> and filters not kinematically feasible trajectories by using <span style="color:#ADD8E6">LatticePlanner._check_paths</span>. Finally, gets best trajectory by minimizing the cost.</li>
<li><strong>Return:</strong> <em><a href="#FrenetPath">best_path</a></em>(<em>FrenetPath</em>) - Trajectory with minimum cost.</li>
<li><a name="LatticePlanner.run_step"></a><strong><font color="#7fb800">run_step</font></strong>(<font color="#00a6ed"><strong>self</strong></font>, <font color="#00a6ed"><strong>state_cartesian</strong></font>)<br />
Main method of LatticePlanner which calls method frenet_optimal_planning to get a best trajectory.</li>
<li><strong>Parameters:</strong><ul>
<li><code>state_cartesian</code> (<em>[x, y, yaw, ds, c]</em>) - Currenet Cartesian coordinate of ego vehicle.</li>
</ul>
</li>
<li><strong>Return:</strong> <em><a href="#Trajectory">Trajectory(waypoints, speeds)</a>(_Trajectory</em>)<em> - which is the list of waypoint </em><code>[x,y]</code>_ and speed.</li>
</ul>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/OpenHUTB/carla_doc" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../..";</script>
    <script src="../../../js/theme_extra.js"></script>
    <script src="../../../js/theme.js"></script>
      <script src="../../../extra.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script src="../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
