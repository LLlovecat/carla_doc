<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>RLlib 集成 - 交通仿真文档</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "RLlib \u96c6\u6210";
        var mkdocs_page_input_path = "tuto_G_rllib_integration.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> 交通仿真文档
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">主页</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">入门</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../start_introduction/">介绍</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../start_quickstart/">快速启动包安装</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_first_steps/">第一步</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tutorials/">教程</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">构建 Carla</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../build_carla/">构建 Carla</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_linux/">Linux 上编译</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_windows/">Windows 上编译</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_update/">Carla 更新</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_system/">编译系统</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_docker/">Docker 中的 Carla</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_faq/">常问的问题</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Carla 主题</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../foundations/">概念和基础</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../core_world/">第一、世界和客户端</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../core_actors/">第二、参与者和蓝图</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../core_map/">第三、地图和导航 </a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../core_sensors/">第四、传感器和数据</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development_tutorials/">开发</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../custom_assets_tutorials/">自定义资产</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_content_authoring_maps/">内容创作 - 地图</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_content_authoring_vehicles/">内容创作 - 车辆</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">交通仿真</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../ts_traffic_simulation_overview/">交通</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_traffic_manager/">交通管理器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_sumo/">和 SUMO 联合仿真</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_scenic/">Scenic</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">行人</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_control_walker_skeletons/">控制行人骨骼</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_generate_pedestrian_navigation/">生成行人导航</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">高级概念</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_opendrive/">OpenDRIVE 独立模式</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_recorder/">记录器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_rendering_options/">渲染选项</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_rss/">责任敏感安全</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_synchrony_timestep/">同步和时间步长</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_benchmarking/">基准性能</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_agents/">Carla 智能体</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">资源</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../python_api/">Python API 参考</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ref_cpp/">C++ 参考</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../bp_library/">蓝图库</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../catalogue/">Carla 目录</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ref_recorder_binary_file_format/">记录器二进制文件格式</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ref_sensors/">传感器参考</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ext_docs/">扩展文档</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">自定义地图</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_custom_map_overview/">Carla 中自定义地图的概述</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_generate_map/">在 RoadRunner 中创建地图</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_add_map_package/">在 Carla 包导入地图</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_add_map_source/">在 Carla 源构建中导入地图</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_add_map_alternative/">导入地图的替代方法</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_manual_map_package/">手动准备地图包</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_custom_layers/">自定义地图：分层地图</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_custom_add_tl/">自定义地图：红绿灯和标志</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_custom_road_painter/">自定义地图：道路画家</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_custom_weather_landscape/">自定义地图：天气和景观</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_openstreetmap/">使用 OpenStreetMap 生成地图</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_custom_buildings/">自定义地图：程序建筑</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_digital_twin/">数字孪生工具</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">大地图</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../large_map_overview/">大地图概述</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../large_map_roadrunner/">在RoadRunner中创建大地图</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../large_map_import/">导入/打包大地图</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">教程（通用）</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_add_friction_triggers/">添加摩擦触发器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_control_vehicle_physics/">控制车辆物理模型</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_retrieve_data/">检索仿真数据</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_docker_unreal/">在 Docker 中构建虚幻引擎和 Carla</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">教程（资产）</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_A_add_vehicle/">添加新车辆</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_A_add_props/">添加新道具</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_A_create_standalone/">创建独立包</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_A_material_customization/">材质定制</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">教程（开发人员）</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_D_contribute_assets/">如何升级内容</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_D_create_sensor/">创建一个传感器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_D_create_semantic_tags/">创建语义标签</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_D_customize_vehicle_suspension/">自定义车辆悬架</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_D_generate_colliders/">生成详细碰撞</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_D_make_release/">发布版本</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_D_windows_debug/">调试程序</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">示例</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_traffic_light/">交通灯的配置和使用</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_traffic_prediction/">流量预测</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Carla 生态系统</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../ecosys_iss/">ISS 智能驾驶系统</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../plugins_carlaviz/">Web 可视化器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ros_documentation/">ROS</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ecosys_femfx/">有限元变形材料虚幻插件</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_carsim_integration/">CarSim 集成</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">RLlib 集成</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#_1">在你开始之前</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#_2">本地运行的要求</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#aws">在 AWS 云上运行的要求</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#rllib_1">RLlib 存储库结构</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#_3">创建您自己的实验</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#1">1. 实验类</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#2">2. 环境配置</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#3">3. 训练和推理脚本</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#dqn">DQN 示例</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#aws_1">在 AWS 上运行</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#aws_2">配置 AWS</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#ami">创建训练 AMI</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_4">配置集群</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_5">运行训练</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#aws-dqn">在 AWS 上运行 DQN 示例</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_chrono/">Chrono 集成</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../OpenRadioss/use_OpenRadioss_windows/">OpenRadios 有限元仿真</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_ptv/">PTV-Vissim 联合仿真</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ecosys_ansys/">Ansys 实时雷达模型</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/darkscyla/MATLAB-Carla-Interface">Matlab 接口</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_G29_windows/">罗技 G29 方向盘</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">贡献</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../cont_contribution_guidelines/">贡献指南</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cont_code_of_conduct/">行为准则</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cont_coding_standard/">编码标准</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cont_doc_standard/">文档标准</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">其他</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="https://ww2.mathworks.cn/help/roadrunner/index.html">RoadRunner</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://ww2.mathworks.cn/help/roadrunner-scenario/index.html">RoadRunner Scenario</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://bbs.carla.org.cn/">Carla 中文站</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/OpenHUTB/engine_doc">虚幻引擎教程</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../todo/">待做列表</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">交通仿真文档</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Carla 生态系统</li>
      <li class="breadcrumb-item active">RLlib 集成</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="rllib">RLlib 集成</h1>
<p>RLlib 集成带来了 <a href="https://github.com/ray-project/ray">Ray/RLlib</a> 库和 Carla 之间的支持，允许轻松使用 Carla 环境进行训练和推理。Ray 是一个开源框架，为构建分布式应用程序提供了简单、通用的 API。Ray 与 RLlib（一个可扩展的强化学习库）和 Tune（一个可扩展的超参数调整库）打包在一起。</p>
<p>RLlib 集成允许用户创建和使用 Carla 作为 Ray 的环境，并将该环境用于训练和推理目的。该集成可以在本地使用，也可以通过 AWS 在云中使用。</p>
<p>在本指南中，我们将概述在本地和 AWS 上运行 RLlib 集成所需的要求、集成存储库的结构、如何使用该库的概述，以及如何使用 Carla 设置 Ray 实验的示例一个环境。</p>
<ul>
<li><a href="#before-you-begin"><strong>在你开始之前</strong></a><ul>
<li><a href="#requirements-for-running-locally">本地运行的要求</a></li>
<li><a href="#requirements-for-running-on-aws-cloud">在 AWS 云上运行的要求</a></li>
</ul>
</li>
<li><a href="#rllib-repository-structure"><strong>RLlib 仓库结构</strong></a></li>
<li><a href="#creating-your-own-experiment"><strong>创建您自己的实验</strong></a><ul>
<li><a href="#1-the-experiment-class">实验类</a></li>
<li><a href="#2-the-environment-configuration">环境配置</a></li>
<li><a href="#3-the-training-and-inference-scripts">训练和推理脚本</a></li>
</ul>
</li>
<li><a href="#dqn-example"><strong>DQN 示例</strong></a></li>
<li><a href="#running-on-aws"><strong>在 AWS 上运行</strong></a><ul>
<li><a href="#configure-aws">配置 AWS</a></li>
<li><a href="#create-the-training-ami">创建训练 AMI</a></li>
<li><a href="#configure-the-cluster">配置集群</a></li>
<li><a href="#run-the-training">运行训练</a></li>
<li><a href="#running-the-dqn-example-on-aws">在 AWS 上运行 DQN 示例</a></li>
</ul>
</li>
</ul>
<hr />
<h2 id="_1">在你开始之前</h2>
<ul>
<li>从 <a href="https://github.com/carla-simulator/rllib-integration/tree/main">GitHub</a> 下载 RLlib 集成或直接克隆仓库：</li>
</ul>
<pre><code class="language-sh">    git clone https://github.com/carla-simulator/rllib-integration.git
</code></pre>
<ul>
<li>要求会有所不同，具体取决于您是在本地运行还是在 AWS 上运行：</li>
</ul>
<blockquote>
<h6 id="_2">本地运行的要求</h6>
<blockquote>
<ul>
<li><a href="https://github.com/carla-simulator/carla/releases">安装 Carla 的软件包版本</a> 并导入 <a href="https://carla.readthedocs.io/en/latest/start_quickstart/#import-additional-assets">附加资源</a> 。<strong>推荐的版本是 Carla 0.9.11</strong> ，因为集成是使用此版本设计和测试的。其他版本可能兼容，但尚未经过充分测试，因此请自行决定使用这些版本。</li>
<li>导航到 RLlib 集成存储库的根文件夹并安装 Python 要求：</li>
</ul>
</blockquote>
</blockquote>
<pre><code>            pip3 install -r requirements.txt
</code></pre>
<blockquote>
<blockquote>
<ul>
<li>通过运行以下命令设置环境变量以查找 Carla 包或添加<code>CARLA_ROOT=path/to/carla</code>到您的<code>.bashrc</code>文件中：</li>
</ul>
</blockquote>
</blockquote>
<pre><code>            export CARLA_ROOT=path/to/carla
</code></pre>
<blockquote>
<h6 id="aws">在 AWS 云上运行的要求</h6>
<blockquote>
<ul>
<li>在 RLlib 集成存储库中找到的安装脚本中会自动满足在 AWS 上运行的要求。<a href="#running-on-aws">在“在 AWS 上运行”</a> 部分中查找更多详细信息。</li>
</ul>
</blockquote>
</blockquote>
<hr />
<h2 id="rllib_1">RLlib 存储库结构</h2>
<p>存储库分为三个目录：</p>
<ul>
<li><code>rllib_integration</code> 包含与 Carla 相关的所有基础设施以及如何设置 Carla 服务器、客户端和参与者。这提供了所有训练和测试实验必须遵循的基本结构。</li>
<li><code>aws</code> 具有在 AWS 实例中运行所需的文件。<code>aws_helper.py</code>提供了多种可简化 EC2 实例管理的功能，包括实例创建以及发送和接收数据。</li>
<li>根目录中的 <code>dqn_example</code> 和 <code>dqn_*</code> 文件提供了一个易于理解的示例，说明如何使用 Carla 作为环境来设置 Ray 实验。 </li>
</ul>
<hr />
<h2 id="_3">创建您自己的实验</h2>
<p>本节概述了如何创建您自己的实验。更具体的示例请参见下一节<a href="#dqn-example">“DQN 示例”</a> 。</p>
<p>您将需要创建至少四个文件：</p>
<ul>
<li>实验类</li>
<li>环境配置</li>
<li>训练和推理脚本</li>
</ul>
<h4 id="1">1. 实验类</h4>
<p>要使用 Carla 环境，您需要定义训练实验。Ray 要求环境返回一系列特定信息。您可以在 <a href="https://github.com/carla-simulator/rllib-integration/blob/main/rllib_integration/carla_env.py"><code>rllib-integration/rllib_integration/carla_env.py</code></a> 中查看有关 Carla 环境的详细信息。</p>
<p>Ray 所需的信息取决于您的具体实验，因此所有实验都应继承自<a href="https://github.com/carla-simulator/rllib-integration/blob/main/rllib_integration/base_experiment.py#L41"><code>BaseExperiment</code></a>。此类包含您自己的实验需要覆盖的所有函数。这些都是与训练的行动、观察和奖励相关的功能。</p>
<h4 id="2">2. 环境配置</h4>
<p>实验应该通过<code>.yaml</code>文件进行配置。通过配置文件传递的任何设置都将覆盖默认设置。下面解释了不同默认设置的位置。</p>
<p>配置文件有三个主要用途：</p>
<ol>
<li>设置大部分 Carla 服务器和客户端设置，例如超时或地图质量。请参阅 <a href="https://github.com/carla-simulator/rllib-integration/blob/main/rllib_integration/carla_core.py#L23">此处</a> 的默认值。 </li>
<li>设置特定于您的实验的变量，以及指定城镇条件以及自我车辆及其传感器的生成。默认设置可在 <a href="https://github.com/carla-simulator/rllib-integration/blob/main/rllib_integration/base_experiment.py#L12">此处</a> 找到，并提供如何设置传感器的示例。</li>
<li>配置特定于 <a href="https://github.com/ray-project/ray/blob/master/rllib/agents/trainer.py">Ray 的训练</a> 设置。这些设置与所使用的特定训练器相关。如果您使用的是内置模型，则可以在此处应用其设置。 </li>
</ol>
<h4 id="3">3. 训练和推理脚本</h4>
<p>最后一步是创建您自己的训练和推理脚本。这部分完全由您决定，并且依赖于 Ray API。如果您想创建自己的特定模型，请查看 <a href="https://docs.ray.io/en/master/rllib-models.html#custom-models-implementing-your-own-forward-logic">Ray 的自定义模型文档</a> 。</p>
<hr />
<h2 id="dqn">DQN 示例</h2>
<p>本节以上一节为基础，展示如何使用 <a href="https://github.com/carla-simulator/rllib-integration/blob/main/rllib_integration/sensors/bird_view_manager.py">BirdView pseudosensor</a> 伪传感器和 Ray 的 <a href="https://github.com/ray-project/ray/blob/master/rllib/agents/dqn/dqn.py#L285">DQNTrainer</a> 进行 RLlib 集成的具体示例。</p>
<p>DQN示例的结构如下：</p>
<ul>
<li><strong>实验类</strong>: <a href="https://github.com/carla-simulator/rllib-integration/blob/main/dqn_example/dqn_experiment.py#L19"><code>DQNExperiment</code></a>，覆盖 <code>BaseExperiment</code> 类的方法。</li>
<li><strong>配置文件</strong>: <a href="https://github.com/carla-simulator/rllib-integration/blob/main/dqn_example/dqn_config.yaml"><code>dqn_example/dqn_config.yaml</code></a></li>
<li><strong>训练文件</strong>: <a href="https://github.com/carla-simulator/rllib-integration/blob/main/dqn_train.py"><code>dqn_train.py</code></a></li>
<li><strong>推理文件</strong>:<ul>
<li><strong>有 Ray</strong>: <a href="https://github.com/carla-simulator/rllib-integration/blob/main/dqn_inference_ray.py"><code>dqn_inference_ray.py</code></a> </li>
<li><strong>没有 Ray</strong>: <a href="https://github.com/carla-simulator/rllib-integration/blob/main/dqn_inference.py"><code>dqn_inference.py</code></a></li>
</ul>
</li>
</ul>
<p>要在本地运行该示例：</p>
<ol>
<li>
<p>安装 pytorch:</p>
<pre><code>pip3 install -r dqn_example/dqn_requirements.txt
</code></pre>
</li>
<li>
<p>运行训练文件：</p>
<pre><code>python3 dqn_train.py dqn_example/dqn_config.yaml --name dqn
</code></pre>
</li>
</ol>
<div class="admonition 笔记">
<p class="admonition-title">笔记</p>
<p>默认配置使用 1 个 GPU 和 12 个 CPU，因此如果您的本地计算机没有该容量，请减小 <a href="https://github.com/carla-simulator/rllib-integration/blob/main/dqn_example/dqn_config.yaml">配置文件</a> 中的数字。</p>
<p>如果遇到内存不足问题，请考虑减少该<code>buffer_size</code>参数。</p>
</div>
<hr />
<h2 id="aws_1">在 AWS 上运行</h2>
<p>本节介绍如何使用 RLlib 集成在 AWS EC2 实例上自动运行训练和推理。为了处理实例的缩放，我们使用<a href="https://docs.ray.io/en/latest/cluster/index.html">Ray autoscaler API</a>。</p>
<h4 id="aws_2">配置 AWS</h4>
<p>您需要正确配置 boto3 环境。请点击 <a href="https://boto3.amazonaws.com/v1/documentation/api/latest/guide/configuration.html">此处</a> 了解更多信息。</p>
<h4 id="ami">创建训练 AMI</h4>
<p>使用提供的 <a href="https://github.com/carla-simulator/rllib-integration/blob/main/aws/aws_helper.py"><code>aws_helper.py</code></a> 脚本通过运行以下命令自动创建训练所需的映像，并传入基础映像的名称和 <code>install.sh</code> 在以下位置  <a href="https://github.com/carla-simulator/rllib-integration/blob/main/aws/install/install.sh"><code>rllib-integration/aws/install</code></a> 找到的安装脚本：</p>
<pre><code>    python3 aws_helper.py create-image --name &lt;AMI-name&gt; --installation-scripts &lt;installation-scripts&gt; --instance-type &lt;instance-type&gt; --volume-size &lt;volume-size&gt;
</code></pre>
<h4 id="_4">配置集群</h4>
<p>创建图像后，将会输出带有图像信息的输出。要使用 Ray 自动缩放器，请使用输出中的信息更新 <a href="https://docs.ray.io/en/latest/cluster/config.html">autoscaler configuration file</a> 中的<code>&lt;ImageId&gt;</code> 和 <code>&lt;SecurityGroupIds&gt;</code> 设置。</p>
<h4 id="_5">运行训练</h4>
<p>创建镜像后，您可以使用 Ray 的 API 在集群上运行训练：</p>
<ol>
<li>
<p>初始化集群：</p>
<pre><code>ray up &lt;autoscaler_configuration_file&gt;
</code></pre>
</li>
<li>
<p>（可选）如果集群初始化后本地代码被修改，请执行以下命令更新：</p>
<pre><code>ray rsync-up &lt;autoscaler_configuration_file&gt; &lt;path_to_local_folder&gt; &lt;path_to_remote_folder&gt;
</code></pre>
</li>
<li>
<p>运行训练：</p>
<pre><code>ray submit &lt;autoscaler_configuration_file&gt; &lt;training_file&gt;
</code></pre>
</li>
<li>
<p>（可选）监控集群状态：</p>
<pre><code>ray attach &lt;autoscaler_configuration_file&gt;
watch -n 1 ray status
</code></pre>
</li>
<li>
<p>关闭集群：</p>
<pre><code>ray down &lt;autoscaler_configuration_file&gt;
</code></pre>
</li>
</ol>
<h4 id="aws-dqn">在 AWS 上运行 DQN 示例</h4>
<p>要在 AWS 上运行 DQN 示例：</p>
<ol>
<li>
<p>通过将 <a href="https://github.com/carla-simulator/rllib-integration/blob/main/dqn_example/dqn_autoscaler.yaml"><code>dqn_example/dqn_autoscaler.yaml</code></a> 配置传递给以下命令来创建映像：</p>
<pre><code>python3 aws_helper.py create-image --name &lt;AMI-name&gt; --installation-scripts install/install.sh --instance-type &lt;instance-type&gt; --volume-size &lt;volume-size&gt;
</code></pre>
</li>
<li>
<p>使用上一个命令 <a href="https://github.com/carla-simulator/rllib-integration/blob/main/dqn_example/dqn_autoscaler.yaml"><code>dqn_autoscaler.yaml</code></a> 提供的信息更新<code>&lt;ImageId&gt;</code>和<code>&lt;SecurityGroupIds&gt;</code>设置。</p>
</li>
<li>
<p>初始化集群：</p>
<pre><code>ray up dqn_example/dqn_autoscaler.yaml
</code></pre>
</li>
<li>
<p>（可选）使用本地更改更新远程文件：</p>
<pre><code>ray rsync-up dqn_example/dqn_autoscaler.yaml dqn_example .
ray rsync-up dqn_example/dqn_autoscaler.yaml rllib_integration .
</code></pre>
</li>
<li>
<p>运行训练：</p>
<pre><code>ray submit dqn_example/dqn_autoscaler.yaml dqn_train.py -- dqn_example/dqn_config.yaml --auto
</code></pre>
</li>
</ol>
<p>6.（可选）监控集群状态：</p>
<pre><code>    ray attach dqn_example/dqn_autoscaler.yaml
    watch -n 1 ray status
</code></pre>
<ol>
<li>关闭集群：<pre><code>ray down dqn_example/dqn_autoscaler.yaml
</code></pre>
</li>
</ol>
<hr />
<p>本指南概述了如何在 AWS 和本地计算机上安装和运行 RLlib 集成。如果您对本指南有任何疑问或遇到任何问题，请随时在 <a href="https://github.com/carla-simulator/carla/discussions/">论坛</a> 中发帖或在 <a href="https://github.com/carla-simulator/rllib-integration">GitHub</a> 上提出问题。</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../tuto_G_carsim_integration/" class="btn btn-neutral float-left" title="CarSim 集成"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../tuto_G_chrono/" class="btn btn-neutral float-right" title="Chrono 集成">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../tuto_G_carsim_integration/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../tuto_G_chrono/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../extra.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
