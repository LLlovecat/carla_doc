<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>第一步 - 交通仿真文档</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "\u7b2c\u4e00\u6b65";
        var mkdocs_page_input_path = "tuto_first_steps.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> 交通仿真文档
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">主页</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">入门</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../start_introduction/">介绍</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../start_quickstart/">快速启动包安装</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">第一步</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#carla_1">启动 Carla 并连接客户端</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#_1">加载地图</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#_2">观察者导航</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#_3">添加非玩家角色</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#_4">添加传感器</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#_5">使用交通管理器仿真车辆</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#_6">将车辆分配为自我车辆</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#_7">选择你的地图</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#_8">选择你的车辆</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tutorials/">教程</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">构建 Carla</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../build_carla/">构建 Carla</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_linux/">Linux 上编译</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_windows/">Windows 上编译</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_update/">Carla 更新</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_system/">编译系统</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_docker/">Docker 中的 Carla</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_faq/">常问的问题</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Carla 主题</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../foundations/">概念和基础</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../core_world/">第一、世界和客户端</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../core_actors/">第二、参与者和蓝图</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../core_map/">第三、地图和导航 </a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../core_sensors/">第四、传感器和数据</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development_tutorials/">开发</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../custom_assets_tutorials/">自定义资产</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_content_authoring_maps/">内容创作 - 地图</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_content_authoring_vehicles/">内容创作 - 车辆</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">交通仿真</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../ts_traffic_simulation_overview/">交通</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_traffic_manager/">交通管理器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_sumo/">和 SUMO 联合仿真</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_scenic/">Scenic</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">行人</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_pedestrian_bones/">行人骨骼</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_control_walker_skeletons/">控制行人骨骼</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_pedestrian_visual/">行人视觉</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_generate_pedestrian_navigation/">生成行人导航</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">高级概念</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_opendrive/">OpenDRIVE 独立模式</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_recorder/">记录器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_rendering_options/">渲染选项</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_rss/">责任敏感安全</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_synchrony_timestep/">同步和时间步长</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_benchmarking/">基准性能</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_agents/">Carla 智能体</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">资源</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../python_api/">Python API 参考</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ref_cpp/">C++ 参考</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../bp_library/">蓝图库</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../catalogue/">Carla 目录</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ref_recorder_binary_file_format/">记录器二进制文件格式</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ref_sensors/">传感器参考</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ext_docs/">扩展文档</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">自定义地图</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_custom_map_overview/">Carla 中自定义地图的概述</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_generate_map/">在 RoadRunner 中创建地图</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_add_map_package/">在 Carla 包导入地图</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_add_map_source/">在 Carla 源构建中导入地图</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_add_map_alternative/">导入地图的替代方法</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_manual_map_package/">手动准备地图包</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_custom_layers/">自定义地图：分层地图</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_custom_add_tl/">自定义地图：红绿灯和标志</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_custom_road_painter/">自定义地图：道路画家</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_custom_weather_landscape/">自定义地图：天气和景观</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_openstreetmap/">使用 OpenStreetMap 生成地图</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_custom_buildings/">自定义地图：程序建筑</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_digital_twin/">数字孪生工具</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">大地图</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../large_map_overview/">大地图概述</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../large_map_roadrunner/">在RoadRunner中创建大地图</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../large_map_import/">导入/打包大地图</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">教程（通用）</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_add_friction_triggers/">添加摩擦触发器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_control_vehicle_physics/">控制车辆物理模型</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_retrieve_data/">检索仿真数据</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_docker_unreal/">在 Docker 中构建虚幻引擎和 Carla</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">教程（资产）</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_A_add_vehicle/">添加新车辆</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_A_add_props/">添加新道具</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_A_create_standalone/">创建独立包</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_A_material_customization/">材质定制</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">教程（开发人员）</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_D_contribute_assets/">如何升级内容</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_D_create_sensor/">创建一个传感器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_D_create_semantic_tags/">创建语义标签</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_D_customize_vehicle_suspension/">自定义车辆悬架</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_D_generate_colliders/">生成详细碰撞</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_D_make_release/">发布版本</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_D_windows_debug/">调试程序</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">示例</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_E_gallery/">入门</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_traffic_light/">交通灯的配置和使用</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_traffic_prediction/">流量预测</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Carla 生态系统</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../ecosys_iss/">ISS 智能驾驶系统</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../plugins_carlaviz/">Web 可视化器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ros_documentation/">ROS</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ecosys_femfx/">有限元变形材料虚幻插件</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_carsim_integration/">CarSim 集成</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_rllib_integration/">RLlib 集成</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_chrono/">Chrono 集成</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../OpenRadioss/use_OpenRadioss_windows/">OpenRadios 有限元仿真</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_ptv/">PTV-Vissim 联合仿真</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ecosys_ansys/">Ansys 实时雷达模型</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/darkscyla/MATLAB-Carla-Interface">Matlab 接口</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_G29_windows/">罗技 G29 方向盘</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">贡献</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../cont_contribution_guidelines/">贡献指南</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cont_code_of_conduct/">行为准则</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cont_coding_standard/">编码标准</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cont_doc_standard/">文档标准</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">其他</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="https://ww2.mathworks.cn/help/roadrunner/index.html">RoadRunner</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://ww2.mathworks.cn/help/roadrunner-scenario/index.html">RoadRunner Scenario</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://bbs.carla.org.cn/">Carla 中文站</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/OpenHUTB/engine_doc">虚幻引擎教程</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://docs.blender.org/manual/zh-hans/latest/">Blender 手册</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../todo/">待做列表</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">交通仿真文档</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">入门</li>
      <li class="breadcrumb-item active">第一步</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="carla">学习 Carla 的第一步</h1>
<p>Carla 仿真器是一个综合解决方案，用于为自动驾驶 (autonomous driving, AD) 和其他机器人应用生成合成训练数据。Carla 仿真高度真实的环境，仿真现实世界中的城镇、城市和高速公路以及占据这些驾驶空间的车辆和其他物体。</p>
<p>Carla 仿真器还可用作评估和测试环境。您可以部署在仿真中训练过的自动驾驶代理来测试和评估其性能和安全性，所有这些都在仿真环境的安全范围内，不会对硬件或其他道路使用者造成风险。</p>
<p>在本教程中，我们将介绍 Carla 中的标准工作流程，从启动服务器和连接客户端，到添加车辆、传感器和生成用于机器学习的训练数据。本教程旨在重点介绍细节，并尽可能高效地介绍使用 Carla 生成机器学习训练数据的关键步骤。有关工作流程每个部分的更多详细信息，例如蓝图库中可用的多种车辆或可用的替代类型传感器，请查阅文本中的链接或浏览左侧菜单。</p>
<ul>
<li><a href="#Launching-carla-and-connecting-the-client"><strong>启动 Carla</strong></a>  </li>
<li><a href="#loading-a-map"><strong>加载地图</strong></a> </li>
<li><a href="#spectator-navigation"><strong>观察者导航</strong></a>  </li>
<li><a href="#adding-npcs"><strong>添加非玩家角色</strong></a>  </li>
<li><a href="#add-sensors"><strong>添加传感器</strong></a>  </li>
<li><a href="#animate-vehicles-with-traffic-manager"><strong>使用交通管理器仿真车辆</strong></a>  </li>
<li><a href="#assign-a-vehicle-as-the-ego-vehicle"><strong>将车辆分配为自我车辆</strong></a></li>
<li><a href="#choose-your-map"><strong>选择你的地图</strong></a> </li>
<li><a href="#choose-your-vehicles"><strong>选择你的车辆</strong></a> </li>
</ul>
<h2 id="carla_1">启动 Carla 并连接客户端</h2>
<p>可以使用 Windows 中的可执行文件或 Linux 中的 shell 脚本通过命令行启动 Carla。按照 <a href="../start_quickstart/"><strong>Linux</strong></a> 和 <a href="../start_quickstart/"><strong>Windows</strong></a> 的安装说明进行操作，然后从命令行 <a href="../start_quickstart/#running-carla"><strong>启动 Carla</strong></a>  ：</p>
<pre><code class="language-sh">cd /carla/root
./CarlaUE4.sh
</code></pre>
<p>要通过 Python API 操作 Carla，我们需要通过开放端口将Python 客户端连接到服务器。客户端通过 <a href="../foundations/#world-and-client"><strong>客户端和世界对象</strong></a> 控制仿真器打开一个 Python 笔记本或创建一个新脚本，然后将以下代码添加到脚本的开头或 main 函数中：</p>
<pre><code class="language-py">import carla
import random

# 链接到客户端并获取世界对象
client = carla.Client('localhost', 2000)
world = client.get_world()

</code></pre>
<p><a href="python_api#carlaclient"><strong>客户端</strong></a> 对象用于维护客户端与服务器的连接，并具有许多用于应用命令以及加载或导出数据的功能。我们可以使用客户端对象加载替代地图或重新加载当前地图（重置为初始状态）。</p>
<p>端口可以选择任何可用的端口，默认设置为 2000，您也可以使用计算机的 IP 地址选择与 <em>localhost</em> 不同的主机。这样，Carla 服务器可以在联网计算机上运行，而 python 客户端可以从个人计算机运行。这对于区分用于运行 Carla 仿真器的 GPU 和用于神经网络训练的 GPU 特别有用，这两者对图形硬件的要求都很高。</p>
<div class="admonition 笔记">
<p class="admonition-title">笔记</p>
<p>以下假设 Carla 在默认异步模式下运行。如果您使用 <a href="../adv_synchrony_timestep/"><strong>同步</strong></a> 模式，以下部分中的某些代码可能无法按预期工作。</p>
</div>
<h2 id="_1">加载地图</h2>
<p>在 Carla API 中，<a href="../python_api/#carla.World"><strong>世界</strong></a> 对象提供对仿真的所有元素的访问，包括地图、地图内的对象，例如建筑物、交通灯、车辆和行人。Carla 服务器通常加载默认地图（通常为 Town10）。如果您想使用备用地图启动 Carla，请使用以下 <code>config.py</code>脚本：</p>
<pre><code class="language-sh">./config.py --map Town05 
</code></pre>
<p>我们还可以使用 world 对象从客户端加载地图：</p>
<pre><code class="language-py">client.load_world('Town05')

</code></pre>
<p>请在 <a href="../core_map/"><strong>此处</strong></a> 查找有关 Carla 地图的更多信息。</p>
<h2 id="_2">观察者导航</h2>
<p>观察者是仿真的视图。默认情况下，当您在连接屏幕的计算机上运行 Carla 服务器时，观众会在新窗口中打开，除非您指定<code>-RenderOffScreen</code> 命令行选项。</p>
<p>观察者有助于可视化您的仿真。使用观察者，您可以熟悉已加载的地图，并查看所做的任何更改的结果，例如添加车辆、更改天气、打开/关闭地图的各个图层以及用于调试目的。</p>
<p>您可以使用鼠标控制观察者视图的俯仰和偏航，并使用 QWE-ASD 键移动观众，让观众飞到世界各地：</p>
<ul>
<li>Q - 向上移动（朝向窗口的顶部边缘）</li>
<li>
<p>E - 向下移动（朝向窗口的下边缘）</p>
</li>
<li>
<p>W - 向前移动</p>
</li>
<li>S - 向后移动</li>
<li>A - 向左移动</li>
<li>D - 向右移动</li>
</ul>
<p>左键单击并在观察者窗口中上下拖动鼠标来控制俯仰，左右拖动鼠标来控制偏航。</p>
<p><img alt="flying_spectator" src="../img/tuto_G_getting_started/flying_spectator.gif" /></p>
<p>观察者及其属性可以通过 Python API 访问和操作：</p>
<pre><code class="language-py"># 获取观察者对象
spectator = world.get_spectator()

# 通过变换获得观察者的位置和旋转
transform = spectator.get_transform()

location = transform.location
rotation = transform.rotation

# 用空变换设置观察者
spectator.set_transform(carla.Transform())
# 这将设置观众在地图的原点，0度俯仰，偏航和滚动-一个很好的方式来定位自己在地图上

</code></pre>
<h2 id="_3">添加非玩家角色</h2>
<p>现在我们已经加载了地图并且服务器已启动并运行，我们现在需要用一些车辆填充我们的仿真，以仿真具有交通和其他道路使用者或非玩家角色的真实环境。</p>
<p>要生成车辆，首先，我们需要从蓝图库中选择我们想要的车辆。</p>
<pre><code class="language-py"># 获取蓝图库和车辆蓝图过滤器
vehicle_blueprints = world.get_blueprint_library().filter('*vehicle*')
</code></pre>
<p>现在我们有了蓝图，我们需要在地图上找到一些合适的地点来生成我们的车辆。为此，每个 Carla 地图都提供了预定义的生成点，均匀分布在整个地图的道路上。</p>
<pre><code class="language-py"># 获得地图的生成点
spawn_points = world.get_map().get_spawn_points()

# 在每个生成点随机生成50辆车，我们从蓝图库中随机选择一辆车
for i in range(0,50):
    world.try_spawn_actor(random.choice(vehicle_blueprints), random.choice(spawn_points))
</code></pre>
<p>现在我们还应该添加一辆车作为仿真的中心点。为了训练自主代理，我们需要仿真自主代理将控制的车辆。用 Carla 的说法，我们经常将这种车辆称为“自我车辆”。</p>
<pre><code class="language-py">ego_vehicle = world.spawn_actor(random.choice(vehicle_blueprints), random.choice(spawn_points))
</code></pre>
<p>除了车辆之外，Carla 还提供行人添加到仿真中，以仿真真实的驾驶场景。在 Carla 术语中，车辆和行人被称为参与者，请在 <a href="../core_actors/"><strong>此处</strong></a> 了解有关它们的更多信息。</p>
<h2 id="_4">添加传感器</h2>
<p>现代自动驾驶汽车通过一系列附加传感器来理解和解释其环境。这些传感器包括光学摄像机、光流摄像机、激光雷达、雷达和加速度计等。Carla 内置了多种类型的传感器模型，用于创建机器学习的训练数据。传感器可以连接到车辆上，也可以连接到固定点来建模，例如闭路电视摄像机。</p>
<p>在这里，我们将在自我车辆上安装一个标准摄像头传感器来记录一些视频数据：</p>
<pre><code class="language-py"># 创建一个变换，将摄像机放置在车辆的顶部
camera_init_trans = carla.Transform(carla.Location(z=1.5))

# 通过定义其属性的蓝图来创建相机
camera_bp = world.get_blueprint_library().find('sensor.camera.rgb')

# 生成相机并将其连接到我们的自我车辆上
camera = world.spawn_actor(camera_bp, camera_init_trans, attach_to=ego_vehicle)
</code></pre>
<p>一旦我们生成了相机，我们需要通过<code>listen()</code>方法将其设置为录制。Listen 方法将定义如何处理数据的回调作为参数。您可以将其流式传输到另一个程序或将其保存到磁盘。</p>
<p>我们将使用 lambda 函数作为回调将数据保存到磁盘：</p>
<pre><code class="language-py"># 用 PyGame 回调启动相机
camera.listen(lambda image: image.save_to_disk('out/%06d.png' % image.frame))
</code></pre>
<p>这会将数据作为一系列根据仿真帧编号命名的 PNG 图像文件保存到 <code>out/</code> 文件夹中。</p>
<p>有多种不同类型的传感器可供选择。在 <a href="../core_sensors/"><strong>这里</strong></a> 您可以更深入地研究可用的传感器阵列以及如何使用它们。</p>
<h2 id="_5">使用交通管理器仿真车辆</h2>
<p>现在我们已经将交通和自我车辆添加到仿真中并开始记录摄像机数据，现在我们需要使用交通管理器将车辆设置为运动。<a href="../adv_traffic_manager/"><strong>交通管理器</strong></a> 是 Carla 的一个组件，它控制车辆在仿真内的地图道路上自动移动，遵循道路惯例并表现得像真正的道路使用者。</p>
<p>我们可以使用<code>world.get_actors()</code>方法找到仿真中的所有车辆，对所有车辆进行过滤。然后我们可以使用该<code>set_autopilot()</code>方法将车辆的控制权移交给交通管理器。</p>
<pre><code class="language-py">for vehicle in world.get_actors().filter('*vehicle*'):
    vehicle.set_autopilot(True)
</code></pre>
<p>现在您的仿真正在运行，有许多车辆在地图上行驶，并且摄像机记录其中一辆车辆的数据。然后，该数据可用于提供机器学习算法来训练自动驾驶代理。流量管理器具有许多用于自定义流量行为的功能，请在 <a href="../tuto_G_traffic_manager/"><strong>此处</strong></a> 了解更多信息。</p>
<p>这是仿真的最基本可能设置，现在您可以更深入地了解有关可用于生成数据的许多额外传感器的文档，以及 Carla 的许多其他功能，这些功能可以使您的仿真更加详细和更多实际的。</p>
<hr />
<h2 id="_6">将车辆分配为自我车辆</h2>
<p><strong>自我车辆</strong> 是使用 Carla 时需要牢记的一个重要概念。自我车辆是指将成为仿真焦点的车辆。在大多数 CARLA 用例中，它可能是您将连接传感器的车辆和/或您的自动驾驶机器学习堆栈将控制的车辆。它很重要，因为它是一些有助于提高仿真效率的仿真操作的基础，例如：</p>
<ul>
<li>
<p><strong>加载大型地图的地图图块</strong>: 大型地图（如 Town 12）由图块组成，仅在需要提高 Carla 性能时才加载。自我车辆的位置决定了使用哪些图块。只有最靠近自我车辆的图块才会被加载。</p>
</li>
<li>
<p><strong>混合物理模式</strong>: 如果您的仿真包含由交通管理器控制的大量车辆，则计算所有这些车辆的物理量在计算上非常昂贵。<a href="../adv_traffic_manager/#hybrid-physics-mode">混合物理模式</a> 使物理计算仅限于自我车辆附近的车辆，从而节省计算资源。</p>
</li>
</ul>
<p>要定义自我车辆，您应该在生成自我车辆时设置<code>role_name</code>车辆<a href="../python_api/#carlaactor">carla.Actor</a> 对象 <a href="../python_api/#carlaactorblueprint">蓝图</a> 的属性：</p>
<pre><code class="language-py">
ego_bp = world.get_blueprint_library().find('vehicle.lincoln.mkz_2020')

ego_bp.set_attribute('role_name', 'hero')

ego_vehicle = world.spawn_actor(ego_bp, random.choice(spawn_points))

</code></pre>
<hr />
<h2 id="_7">选择你的地图</h2>
<p><img alt="maps_montage" src="../img/catalogue/maps/maps_montage.webp" /></p>
<p>Carla 附带了几张预制地图，专注于提供多种功能。这些地图呈现了城市、乡村和住宅等一系列环境。还有不同的建筑风格和多种不同的道路布局，从无标记的乡村道路到多车道高速公路。浏览<a href="../catalogue/">目录</a>或下表中的地图指南。</p>
<table>
<thead>
<tr>
<th>城镇</th>
<th>概括</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="../map_town01/"><strong>城镇01</strong></a></td>
<td>一个简单的小镇，有一条河流和几座桥梁。</td>
</tr>
<tr>
<td><a href="../map_town02/"><strong>城镇02</strong></a></td>
<td>一个简单的小镇，住宅和商业建筑混合在一起。</td>
</tr>
<tr>
<td><a href="../map_town03/"><strong>城镇03</strong></a></td>
<td>更大的城市地图，带有环岛和大型路口。</td>
</tr>
<tr>
<td><a href="../map_town04/"><strong>城镇04</strong></a></td>
<td>一座镶嵌在群山之中的小镇，有一条特殊的“8字形”<em>无限</em>公路。</td>
</tr>
<tr>
<td><a href="../map_town05/"><strong>城镇05</strong></a></td>
<td>方形网格城镇，有十字路口和一座桥梁。每个方向有多个车道。对于执行变道很有用。</td>
</tr>
<tr>
<td><a href="../map_town06/"><strong>城镇06</strong></a></td>
<td>长的多车道高速公路，有许多高速公路入口和出口。它还有一个 <a href="https://en.wikipedia.org/wiki/Michigan_left"><strong>密歇根左翼</strong></a> 。</td>
</tr>
<tr>
<td><a href="../map_town07/"><strong>城镇07</strong></a></td>
<td>乡村环境，道路狭窄，有玉米、谷仓，几乎没有红绿灯。</td>
</tr>
<tr>
<td><strong>城镇08</strong></td>
<td>用于 <a href="https://leaderboard.carla.org/">排行榜</a> 挑战的秘密“看不见”小镇</td>
</tr>
<tr>
<td><strong>城镇09</strong></td>
<td>用于 <a href="https://leaderboard.carla.org/">排行榜</a> 挑战的秘密“看不见”小镇</td>
</tr>
<tr>
<td><a href="../map_town10/"><strong>城镇10</strong></a></td>
<td>市中心的城市环境，拥有摩天大楼、住宅楼和海滨长廊。</td>
</tr>
<tr>
<td><strong>城镇11</strong></td>
<td>未装饰的大地图。</td>
</tr>
<tr>
<td><a href="../map_town12/"><strong>城镇12</strong></a></td>
<td>一张包含许多不同区域的大地图，包括高层建筑、住宅区和乡村环境。</td>
</tr>
</tbody>
</table>
<p>您可以浏览 Carla 安装中的可用地图：</p>
<pre><code class="language-py">client.get_available_maps()
</code></pre>
<p>这将包括您自己构建或导入的地图。</p>
<p>当您选择地图时，请像这样加载它：</p>
<pre><code class="language-py">client.load_world('Town03_Opt')
</code></pre>
<hr />
<h2 id="_8">选择你的车辆</h2>
<p><img alt="vehicles_overview" src="../img/catalogue/vehicles/vehicle_montage.webp" /></p>
<p>Carla 提供了一个车辆库，可以让您的仿真充满交通。浏览 <a href="../catalogue_vehicles/">Carla 车辆目录</a> 中的车辆型号。</p>
<p>您可以通过过滤蓝图库来查看所有可用的车辆蓝图。</p>
<pre><code class="language-py">for bp in world.get_blueprint_library().filter('vehicle'):
    print(bp.id)
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../start_quickstart/" class="btn btn-neutral float-left" title="快速启动包安装"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../tutorials/" class="btn btn-neutral float-right" title="教程">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../start_quickstart/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../tutorials/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../extra.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
