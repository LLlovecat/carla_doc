<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>添加新车辆 - 交通仿真文档</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "\u6dfb\u52a0\u65b0\u8f66\u8f86";
        var mkdocs_page_input_path = "tuto_A_add_vehicle.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> 交通仿真文档
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">主页</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">入门</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../start_introduction/">介绍</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../start_quickstart/">快速启动包安装</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_first_steps/">第一步</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tutorials/">教程</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">构建 Carla</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../build_carla/">构建 Carla</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_linux/">Linux 上编译</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_windows/">Windows 上编译</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_update/">Carla 更新</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_system/">编译系统</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_docker/">Docker 中的 Carla</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_faq/">常问的问题</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Carla 主题</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../foundations/">概念和基础</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../core_world/">第一、世界和客户端</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../core_actors/">第二、参与者和蓝图</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../core_map/">第三、地图和导航 </a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../core_sensors/">第四、传感器和数据</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development_tutorials/">开发</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../custom_assets_tutorials/">自定义资产</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_content_authoring_maps/">内容创作 - 地图</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_content_authoring_vehicles/">内容创作 - 车辆</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">交通仿真</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../ts_traffic_simulation_overview/">交通</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_traffic_manager/">交通管理器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_sumo/">和 SUMO 联合仿真</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_scenic/">Scenic</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">行人</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_pedestrian_bones/">行人骨骼</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_control_walker_skeletons/">控制行人骨骼</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_pedestrian_visual/">行人视觉</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_generate_pedestrian_navigation/">生成行人导航</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">高级概念</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_opendrive/">OpenDRIVE 独立模式</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_recorder/">记录器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_rendering_options/">渲染选项</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_rss/">责任敏感安全</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_synchrony_timestep/">同步和时间步长</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_benchmarking/">基准性能</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_agents/">Carla 智能体</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">资源</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../python_api/">Python API 参考</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ref_cpp/">C++ 参考</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../bp_library/">蓝图库</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../catalogue/">Carla 目录</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ref_recorder_binary_file_format/">记录器二进制文件格式</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ref_sensors/">传感器参考</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ext_docs/">扩展文档</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">自定义地图</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_custom_map_overview/">Carla 中自定义地图的概述</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_generate_map/">在 RoadRunner 中创建地图</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_add_map_package/">在 Carla 包导入地图</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_add_map_source/">在 Carla 源构建中导入地图</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_add_map_alternative/">导入地图的替代方法</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_manual_map_package/">手动准备地图包</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_custom_layers/">自定义地图：分层地图</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_custom_add_tl/">自定义地图：红绿灯和标志</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_custom_road_painter/">自定义地图：道路画家</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_custom_weather_landscape/">自定义地图：天气和景观</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_openstreetmap/">使用 OpenStreetMap 生成地图</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_custom_buildings/">自定义地图：程序建筑</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_digital_twin/">数字孪生工具</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">大地图</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../large_map_overview/">大地图概述</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../large_map_roadrunner/">在RoadRunner中创建大地图</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../large_map_import/">导入/打包大地图</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">教程（通用）</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_add_friction_triggers/">添加摩擦触发器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_control_vehicle_physics/">控制车辆物理模型</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_retrieve_data/">检索仿真数据</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_docker_unreal/">在 Docker 中构建虚幻引擎和 Carla</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">教程（资产）</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">添加新车辆</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#4">添加 4 轮车辆</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#_2">绑定并建模车辆</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_3">导入并配置车辆</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#add-an-n-wheeled-vehicle">Add an N wheeled vehicle</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#add-a-2-wheeled-vehicle">Add a 2 wheeled vehicle</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_A_add_props/">添加新道具</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_A_create_standalone/">创建独立包</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_A_material_customization/">材质定制</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">教程（开发人员）</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_D_contribute_assets/">如何升级内容</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_D_create_sensor/">创建一个传感器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_D_create_semantic_tags/">创建语义标签</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_D_customize_vehicle_suspension/">自定义车辆悬架</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_D_generate_colliders/">生成详细碰撞</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_D_make_release/">发布版本</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_D_windows_debug/">调试程序</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">示例</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_E_gallery/">入门</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_traffic_light/">交通灯的配置和使用</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_traffic_prediction/">流量预测</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Carla 生态系统</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../ecosys_iss/">ISS 智能驾驶系统</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../plugins_carlaviz/">Web 可视化器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ros_documentation/">ROS</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ecosys_femfx/">有限元变形材料虚幻插件</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_carsim_integration/">CarSim 集成</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_rllib_integration/">RLlib 集成</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_chrono/">Chrono 集成</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../OpenRadioss/use_OpenRadioss_windows/">OpenRadios 有限元仿真</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_ptv/">PTV-Vissim 联合仿真</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ecosys_ansys/">Ansys 实时雷达模型</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/darkscyla/MATLAB-Carla-Interface">Matlab 接口</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_G29_windows/">罗技 G29 方向盘</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">贡献</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../cont_contribution_guidelines/">贡献指南</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cont_code_of_conduct/">行为准则</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cont_coding_standard/">编码标准</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cont_doc_standard/">文档标准</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">其他</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="https://ww2.mathworks.cn/help/roadrunner/index.html">RoadRunner</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://ww2.mathworks.cn/help/roadrunner-scenario/index.html">RoadRunner Scenario</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://bbs.carla.org.cn/">Carla 中文站</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/OpenHUTB/engine_doc">虚幻引擎教程</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://docs.blender.org/manual/zh-hans/latest/">Blender 手册</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../file_specification/">文件说明</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../todo/">待做列表</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">交通仿真文档</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">教程（资产）</li>
      <li class="breadcrumb-item active">添加新车辆</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="_1"><a href="https://carla.readthedocs.io/en/latest/tuto_A_add_vehicle/">添加新车</a></h1>
<p>这个教程详细介绍了如何向 Carla 添加新的车辆。教程分为两个部分，一个用于四轮车辆，另一个用于两轮车辆。教程概述了建模车辆时必须满足的基本要求，以确保车辆在 Carla 中运行良好，并提供了在将车辆导入虚幻引擎后所需的配置说明。</p>
<ul>
<li><a href="#add-a-4-wheeled-vehicle"><strong>添加 4 轮车辆</strong></a></li>
<li><a href="#bind-and-model-the-vehicle">绑定并建模车辆</a></li>
<li><a href="#import-and-configure-the-vehicle">导入并配置车辆</a></li>
<li><a href="#add-a-2-wheeled-vehicle"><strong>添加 2 轮车辆</strong></a></li>
</ul>
<div class="admonition 重要">
<p class="admonition-title">重要</p>
<p>本教程仅适用于使用源代码构建并有权访问虚幻引擎编辑器的用户。</p>
</div>
<hr />
<h2 id="4">添加 4 轮车辆</h2>
<p>添加到 Carla 的车辆需要使用可在 <a href="(https://carla-assets.s3.eu-west-3.amazonaws.com/fbx/VehicleSkeleton.rar)"><strong>此处</strong></a> 找到的通用基础骨架。此链接将下载一个名为 <code>VehicleSkeleton.rar</code> 的文件夹，其中包含两种不同格式的基本框架，一种为 ASCII，另一种为二进制。您使用的格式取决于您的 3D 建模软件要求。</p>
<p><strong>骨架骨骼的位置可以更改，但任何其他操作（例如旋转、添加新骨骼或更改当前层次结构）都会导致错误。</strong></p>
<hr />
<h3 id="_2">绑定并建模车辆</h3>
<p>本节详细介绍了车辆建模阶段的最低要求，以确保其可以在 Carla 中成功使用。该过程包括将骨架正确绑定到车辆的底座和车轮、创建物理资源和光线投射传感器网格，以及导出为正确的格式。</p>
<p><strong>1. 导入基础骨架。</strong></p>
<p>将基础骨架导入您首选的三维建模软件中。常见的编辑器包括 Maya 和 Blender。</p>
<p><strong>2. 绑定骨骼。</strong></p>
<p>根据下面的命名法将骨骼绑定到车辆网格的相应部分。确保轮子的骨骼在网格内居中。</p>
<ul>
<li><strong>左前轮：</strong> <code>Wheel_Front_Left</code></li>
<li><strong>右前轮：</strong> <code>Wheel_Front_Right</code></li>
<li><strong>左后轮：</strong> <code>Wheel_Rear_Left</code></li>
<li><strong>右后轮：</strong> <code>Wheel_Rear_Right</code></li>
<li><strong>网格的其余部分：</strong> <code>VehicleBase</code></li>
</ul>
<div class="admonition 警告">
<p class="admonition-title">警告</p>
<p>不要对骨骼名称或层次结构进行任何更改，也不要添加任何新骨骼。</p>
</div>
<p><strong>3.  为您的车辆建模。</strong></p>
<p>车辆应拥有大约 50,000 - 100,000 个 tris。我们使用实际汽车的尺寸和比例来建模车辆。</p>
<p>我们建议您将车辆分为以下材质：</p>
<blockquote>
<ol>
<li><strong>Bodywork</strong>: 车辆的金属部分。该材质已更改为虚幻引擎材质。可以添加徽标和细节，但为了可见，必须使用虚幻引擎编辑器中的 Alpha 通道将它们绘制为不同的颜色。</li>
<li><strong>Glass_Ext</strong>: 一层玻璃，可以从车辆外部看到内部。</li>
<li><strong>Glass_Int</strong>: 一层玻璃，允许从车辆内部到外部的可见性。</li>
<li><strong>Lights</strong>: 头灯、指示灯等。</li>
<li><strong>LightGlass_Ext</strong>: 一层玻璃，允许从外部到内部的灯光可见性。</li>
<li><strong>LightGlass_Int</strong>: 一层玻璃，允许从内部到外部看到光。</li>
<li><strong>LicensePlate</strong>: 29x12 厘米的矩形平面。您可以使用 Carla 提供的 <code>.fbx</code> 以获得最佳结果，请在 <a href="https://carla-assets.s3.eu-west-3.amazonaws.com/fbx/LicensePlate.rar">此处</a> 下载。纹理将在虚幻引擎中自动分配。</li>
<li><strong>Interior</strong>: 任何其他不适合上述部分的细节都可以进入 <em>内饰</em>.</li>
</ol>
</blockquote>
<p>材料（Material）应使用格式 <code>M_CarPart_CarName</code> 命名，例如 <code>M_Bodywork_Mustang</code>。</p>
<p>纹理（Textures）应使用格式 <code>T_CarPart_CarName</code>命名，例如 <code>T_Bodywork_Mustang</code>。纹理的大小应为 2048x2048。</p>
<p>虚幻引擎会自动创建(Level of Details, LOD)，但您也可以在 3D 编辑器中手动创建它们。Tri 计数如下：</p>
<ul>
<li><strong>LOD 0</strong>: 100,000 tris</li>
<li><strong>LOD 1</strong>: 80,000 tris</li>
<li><strong>LOD 2</strong>: 60,000 tris</li>
<li><strong>LOD 3</strong>: 30,000 tris</li>
</ul>
<p><strong>4. 创建物理资源网格。</strong></p>
<p>物理资源网格是一个附加网格，允许虚幻引擎计算车辆的物理特性。它应该尽可能简单，减少多边形数量，并且应该覆盖除车轮之外的整个车辆。请参阅下图的示例。</p>
<blockquote>
<blockquote>
<p><img alt="physical asset mesh" src="../img/physical_asset_mesh.png" /></p>
</blockquote>
</blockquote>
<p>物理资源网格应导出为单独的<code>.fbx</code>文件。最终文件应满足以下要求：</p>
<ul>
<li>有一个基础网格。这应该是物理资源网格的副本。它应该与原始车辆具有相同的名称。</li>
<li>物理资源网格体必须使用格式  <code>UCX_&lt;vehicle_name&gt;_&lt;number_of_mesh&gt;</code>命名， <strong>否则虚幻引擎将无法识别。</strong></li>
<li>网格不得超出原始模型的边界。</li>
<li>网格应与原始模型具有相同的位置。</li>
</ul>
<blockquote>
<blockquote>
<p><img alt="base mesh" src="../img/base_mesh.png" /></p>
</blockquote>
</blockquote>
<p>将最终 <code>.fbx</code> 网格导出为名为 <code>SMC_&lt;vehicle_name&gt;.fbx</code>的文件。</p>
<p><strong>5. 为光线投射传感器创建网格。</strong></p>
<p>光线投射传感器网格设置将由光线投射传感器（RADAR、LiDAR 和 Semantic LiDAR）检测到的车辆形状。该网格应该具有比物理资产网格稍微更明确的几何形状，以提高传感器仿真的真实感，但出于性能原因，不如汽车网格那么详细。</p>
<p>创建光线投射传感器网格时请考虑以下几点：</p>
<ul>
<li>网格应覆盖车辆的各个方面，包括车轮、后视镜和格栅。</li>
<li>轮子应为不超过 16 圈的圆柱体。</li>
<li>如果需要，可以将各种网格连接在一起。</li>
<li>网格不得超出原始模型的边界。</li>
<li>网格应该与原始网格具有相同的位置。</li>
</ul>
<blockquote>
<blockquote>
<p><img alt="collision mesh" src="../img/collision_mesh.png" /></p>
</blockquote>
</blockquote>
<p>将最终网格导出名为 <code>SM_sc_&lt;vehicle_name&gt;.fbx</code> 的 <code>.fbx</code> 文件。</p>
<p><strong>5. 导出车辆网格。</strong></p>
<p>选择所有主要车辆网格和骨架底座并导出为<code>.fbx</code>。</p>
<hr />
<h3 id="_3">导入并配置车辆</h3>
<p>本节详细介绍了将车辆导入虚幻引擎以在 Carla 中使用的过程。在虚幻引擎编辑器中执行这些步骤。</p>
<p><strong>1. 创建车辆文件夹。</strong></p>
<p>在 <code>Content/Carla/Static/Vehicles/4Wheeled</code> 里创建一个名为 <code>&lt;vehicle_name&gt;</code> 的新文件夹。</p>
<p><strong>2. 导入 <code>.fbx</code>。</strong></p>
<p>Inside the new vehicle folder, import your main vehicle skeleton <code>.fbx</code> by right-clicking in the <strong><em>Content Browser</em></strong> and selecting <strong><em>Import into Game/Carla/Static/Vehicles/4Wheeled/&lt;vehicle_name&gt;</em></strong>.</p>
<p>In the dialogue box that pops up:</p>
<ul>
<li>Set <strong><em>Import Content Type</em></strong> to <code>Geometry and Skinning Weights</code>.</li>
<li>Set <strong><em>Normal Import Method</em></strong> to <code>Import Normals</code>.</li>
<li>Optionally set <strong><em>Material Import Method</em></strong> to <code>Do not create materials</code>. Uncheck <strong><em>Import Textures</em></strong> to avoid Unreal Engine creating default materials.</li>
</ul>
<p>The Skeletal Mesh will appear along with two new files, <code>&lt;vehicle_name&gt;_PhysicsAssets</code> and <code>&lt;vehicle_name&gt;_Skeleton</code>.</p>
<p>Import the rest of your <code>.fbx</code> files separately from the main vehicle skeleton <code>.fbx</code> file.</p>
<p><strong>3. Set the physical asset mesh.</strong></p>
<blockquote>
<ol>
<li>Open <code>&lt;vehicle_name&gt;_PhysicsAssets</code> from the <strong><em>Content Browser</em></strong>.</li>
<li>Right-click on the <code>Vehicle_Base</code> mesh in the <strong><em>Skeleton Tree</em></strong> panel and go to <strong><em>Copy Collision from StaticMesh</em></strong>.</li>
<li>Search for and select your <code>SMC_&lt;vehicle_name&gt;</code> file. You should see the outline of the physical asset mesh appear in the viewport.</li>
<li>Delete the default capsule shape from the <code>Vehicle_Base</code>.</li>
<li>Select all the wheels:<ul>
<li>Go to the <strong><em>Tools</em></strong> panel and change the <strong><em>Primitive Type</em></strong> to <code>Sphere</code>.</li>
<li>Go to the <strong><em>Details</em></strong> panel and change <strong><em>Physics Type</em></strong> to <code>Kinematic</code>.</li>
<li>Set <strong><em>Linear Damping</em></strong> to <code>0</code>. This will eliminate any extra friction on the wheels.</li>
</ul>
</li>
<li>Enable <strong><em>Simulation Generates Hit Event</em></strong> for all meshes.</li>
<li>Click <strong><em>Re-generate Bodies</em></strong>.</li>
<li>Adjust the wheel sphere to the size of the wheel.</li>
<li>Save and close the window.</li>
</ol>
<p><img alt="Collision mesh" src="../img/collision_mesh_vehicle.png" /></p>
</blockquote>
<p><strong>4. Create the Animation Blueprint.</strong></p>
<blockquote>
<ol>
<li>In the <strong><em>Content Browser</em></strong>, right-click inside your vehicle folder and select <strong><em>Animation -&gt; Animation Blueprint</em></strong>.</li>
<li>In <strong><em>Parent Class</em></strong> search for and select <code>VehicleAnimInstance</code>.</li>
<li>In <strong><em>Target Skeleton</em></strong> search for and select <code>&lt;vehicle_name&gt;_Skeleton</code>.</li>
<li>Press <strong><em>OK</em></strong> and rename the blueprint as <code>AnimBP_&lt;vehicle_name&gt;</code>.</li>
</ol>
</blockquote>
<p><strong>5. Configure the Animation Blueprint.</strong></p>
<p>To ease the process of configuring the animation blueprint, we will copy an existing one from a native Carla vehicle:</p>
<blockquote>
<ol>
<li>Go to <code>Content/Carla/Static/Vehicle</code> and choose any Carla vehicle folder. Open its Animation Blueprint.</li>
<li>In the <strong><em>My Blueprint</em></strong> panel, double click on <strong><em>AnimGraph</em></strong>. You will see the graph come up in the viewport.</li>
<li>Click and drag to select the <strong><em>Mesh Space Ref Pose</em></strong>, <strong><em>Wheel Handler</em></strong>, and <strong><em>Component To Local</em></strong> components. Right-click and select <strong><em>Copy</em></strong>.</li>
<li>Go back to your own vehicle Animation Blueprint and paste the copied contents into the graph area.</li>
<li>Click and drag from the standing figure in the <strong><em>Component To Local</em></strong> component to the figure in <strong><em>Output Pose</em></strong> to join the components together.</li>
<li>Click <strong><em>Compile</em></strong> in the top left corner. You should now see a pulsating line flowing through the entire sequence.</li>
<li>Save and close the window.</li>
</ol>
<blockquote>
<p><img alt="add_vehicle_step_04" src="../img/add_vehicle_step_04.jpg" /></p>
</blockquote>
</blockquote>
<p><strong>6. Prepare the vehicle and wheel blueprints.</strong></p>
<blockquote>
<ol>
<li>In the <strong><em>Content Browser</em></strong>, go to <code>Content/Carla/Blueprints/Vehicles</code> and create a new folder <code>&lt;vehicle_name&gt;</code>.</li>
<li>Inside the folder, right-click and go to <strong><em>Blueprint Class</em></strong>. Open the <strong><em>All Classes</em></strong> section in the pop-up.</li>
<li>Search for <code>BaseVehiclePawn</code> and press <strong><em>Select</em></strong>.</li>
<li>Rename the file as <code>BP_&lt;vehicle_name&gt;</code>.</li>
<li>Go to the folder of any of the native Carla vehicles in <code>Carla/Blueprints/Vehicles</code>. From the <strong><em>Content Browser</em></strong>, copy the four wheel blueprints into the blueprint folder for your own vehicle. Rename the files to replace the old vehicle name with your own vehicle name.</li>
</ol>
<blockquote>
<p><img alt="Copy wheel blueprints" src="../img/copy_wheel_blueprint.png" /></p>
</blockquote>
</blockquote>
<p><strong>7. Configure the wheel blueprints.</strong></p>
<blockquote>
<ol>
<li>In your vehicle blueprint folder, open all four of the wheel blueprints.</li>
<li>In the <strong><em>Class Defaults</em></strong> panel, set <strong><em>Collision Mesh</em></strong> to <code>Wheel_Shape</code>. <strong>Omitting this step will cause the vehicle wheels to sink into the ground</strong>.</li>
<li>Adjust the values for wheel shape radius, width, mass, and damping rate according to your vehicle specifications.</li>
<li>Set <strong><em>Tire Config</em></strong> to <code>CommonTireConfig</code></li>
<li>On the front wheels set <strong><em>Steer Angle</em></strong> according to your preferences (default is <code>70</code>). Uncheck <strong><em>Affected by Handbrake</em></strong>.</li>
<li>On the rear wheels set <strong><em>Steer Angle</em></strong> to <code>0</code>. Check <strong><em>Affected by Handbrake</em></strong>.</li>
<li>When setting the suspension values, you can use the values <a href="../tuto_D_customize_vehicle_suspension/">here</a> as a guide.</li>
<li>Compile and save.</li>
</ol>
<blockquote>
<p><img alt="wheel shape" src="../img/wheel_shape.png" /></p>
</blockquote>
</blockquote>
<p><strong>8. Configure vehicle blueprint.</strong></p>
<blockquote>
<ol>
<li>From the <strong><em>Content Browser</em></strong>, open your <code>BP_&lt;vehicle_name&gt;</code>.</li>
<li>In the <strong><em>Components</em></strong> panel, select <strong><em>Mesh (VehicleMesh) (Inherited)</em></strong>.</li>
<li>In the <strong><em>Details</em></strong> panel, go to <strong><em>Skeletal Mesh</em></strong> and search for and select the base skeleton file of your vehicle (located in the <code>Carla/Static/Vehicles/4Wheeled/&lt;vehicle_name&gt;</code> folder).</li>
<li>Go to <strong><em>Anim Class</em></strong> in the <strong><em>Details</em></strong> panel. Search for and select your <code>AnimBP_&lt;vehicle_name&gt;</code> file.</li>
<li>In the <strong><em>Components</em></strong> panel, select <strong><em>Custom Collision (Inherited)</em></strong>.</li>
<li>Select <strong><em>Static Mesh</em></strong> in the <strong><em>Details</em></strong> panel and search for your <code>SM_sc_&lt;vehicle_name&gt;</code> raycast sensor mesh.</li>
<li>In the <strong><em>Components</em></strong> panel, select <strong><em>VehicleMovement (MovementComp) (Inherited)</em></strong>.</li>
<li>In the <strong><em>Details</em></strong> panel, search for <code>wheel</code>. You will find settings for each of the wheels. For each one, click on <strong><em>Wheel Class</em></strong> and search for the <code>BP_&lt;vehicle_name&gt;_&lt;wheel_name&gt;</code> file that corresponds to the correct wheel position.</li>
</ol>
<blockquote>
<blockquote>
<blockquote>
<p><img alt="wheel blueprint" src="../img/wheel_blueprint.png" /></p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
<p>If you have any additional meshes for your vehicle (doors, lights, etc.,) separate from the base mesh:</p>
<blockquote>
<ol>
<li>Drag them into the <strong><em>Mesh (VehicleMesh) (Inherited)</em></strong> hierarchy in the <strong><em>Components</em></strong> panel.</li>
<li>Select the extra meshes in the hierarchy and search for <code>Collision</code> in the <strong><em>Details</em></strong> panel.</li>
<li>Set <strong><em>Collision Presets</em></strong> to <code>NoCollision</code>.</li>
<li>Select any lights meshes in the hierarchy. Search for <code>Tag</code> in the <strong><em>Details</em></strong> panel and add the tag <code>emissive</code>.</li>
</ol>
</blockquote>
<p>Click <strong><em>Save</em></strong> and <strong><em>Compile</em></strong>.</p>
<p><strong>9. Add the vehicle to the Blueprint Library</strong>.</p>
<blockquote>
<ol>
<li>In <code>Content/Carla/Blueprint/Vehicle</code>, open the <code>VehicleFactory</code> file.</li>
<li>In the <strong><em>Generate Definitions</em></strong> tab, double click <strong><em>Vehicles</em></strong>.</li>
<li>In the <strong><em>Details</em></strong> panel, expand the <strong><em>Default Value</em></strong> section and add a new element to the vehicles array.</li>
<li>Fill in the <strong><em>Make</em></strong> and <strong><em>Model</em></strong> of your vehicle.</li>
<li>Fill in the <strong><em>Class</em></strong> value with your <code>BP_&lt;vehicle_name&gt;</code> file.</li>
<li>Optionally, provide a set of recommended colors for the vehicle.</li>
<li>Compile and save.</li>
</ol>
<p><img alt="vehicle factory" src="../img/vehicle_factory.png" /></p>
</blockquote>
<p><strong>10. Test the vehicle</strong>.</p>
<p>Launch Carla, open a terminal in <code>PythonAPI/examples</code> and run the following command:</p>
<pre><code class="language-sh">python3 manual_control.py --filter &lt;model_name&gt; # The make or model defined in step 9
</code></pre>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Even if you used upper case characters in your make and model, they need to be converted to lower case when passed to the filter.</p>
</div>
<hr />
<h2 id="add-an-n-wheeled-vehicle">Add an N wheeled vehicle</h2>
<p>Adding an N wheeled vehicle follows the same import pipeline as that for 4 wheeled vehicles above with a few steps that are different. </p>
<p><strong>5.</strong> <strong>Configure the Animation Blueprint for an N wheeled vehicle</strong></p>
<p>Search for <code>BaseVehiclePawnNW</code> and press <strong><em>Select</em></strong>.</p>
<p><img alt="n_wheel_base" src="../img/base_nw.png" /></p>
<p><strong>6.</strong> <strong>Prepare the vehicle and wheel blueprints</strong></p>
<p>Go to the folder of any native Carla vehicles in Carla/Blueprints/Vehicles. From the Content Browser, copy the four wheel blueprints into the blueprint folder for your own vehicle. Rename the files to replace the old vehicle name with your own vehicle name.</p>
<p>Copy the four wheels and copy again for additional wheels. In the case of a 6 wheeled vehicle, you will need 6 different wheels: FLW, FRW, MLW, MRW, RLW, RRW.</p>
<p><img alt="n_wheel_bps" src="../img/nwheels.png" /></p>
<p><strong>7.</strong> <strong>Configure the wheel blueprints</strong></p>
<p>Follow section <strong>7</strong> as above for the 4 wheeled vehicle. The key difference in the case of an N wheeled vehicle is those affected by handbrake and steering parameters. In some vehicles (like for example a long wheelbase truck) the front 2 pairs of wheels will steer, and one set may steer more than others. The rearmost pairs may be affected by handbrake, the specifics will depend upon the vehicle you are modelling.</p>
<p><strong>8.</strong> <strong>Configure vehicle blueprint</strong></p>
<p>In the Details panel, search for <code>wheel</code>. You will find settings for each of the wheels. For each one, click on Wheel Class and search for the BP_<vehicle_name>_<wheel_name> file that corresponds to the correct wheel position.</p>
<p>This is correct, but just to specify, in the case of N wheeled vehicles, you need to set ALL the wheels. This is an example with a 6 wheeled vehicle:</p>
<p><img alt="n_wheel_config" src="../img/nwheel_config.png" /></p>
<p>Finally, an additional consideration is setting the differential. In the case of a 4 wheeled vehicle, we have different presets of differentials (Limited Slip, Open 4W etc.) but with N wheeled vehicles, you need to choose on which wheels you want to apply torque. In this case, we have chosen only the middle and rear wheels have torque, while the front wheels don’t, you can specify other configurations. The numbers are going to be the same as the image above this text (e.g. 0 will be the Front Left Wheel, as specified above).</p>
<p><img alt="n_wheel_mech" src="../img/nwheel_mech_setup.png" /></p>
<p>All other parameters such as engine, transmission, steering curve, are the same as 4 wheeled vehicles. </p>
<hr />
<h2 id="add-a-2-wheeled-vehicle">Add a 2 wheeled vehicle</h2>
<p>Adding 2 wheeled vehicles is similar to adding a 4 wheeled one but due to the complexity of the animation you'll need to set up aditional bones to guide the driver's animation. <a href="https://carla-assets.s3.eu-west-3.amazonaws.com/fbx/BikeSkeleton.rar">Here</a> is the link to the reference skeleton for 2 wheeled vehicles.</p>
<p>As with the 4 wheeled vehicles, orient the model towards positive "x" and every bone axis towards
positive x and with the z axis facing upwards.</p>
<pre><code class="language-yaml">Bone Setup:
  - Bike_Rig:                   # The origin point of the mesh. Place it in the point 0 of the scenecomment
    - BikeBody:                 # The model's body centre.
      - Pedals:                 # If the vehicle is a bike bind the pedalier to this bone, will rotate with the bike acceleration.
        - RightPedal:           # Sets the driver's feet position and rotates with the pedalier if the vehicle is a bike.
        - LeftPedal:            # ^
      - RearWheel:              # Rear Wheel of the vehicle
      - Handler:                # Rotates with the frontal wheel of the vehicle bind the vehicle handler to it.
        - HandlerMidBone:       # Positioned over the front wheel bone to orient the handler with the wheel
        - HandlerRight:         # Sets the position of the driver's hand, no need to bind it to anything.
        - HandlerLeft:          # ^
      - Frontwheel:             # Frontal wheel of the vehicle.
      - RightHelperRotator:     # This four additional bones are here for an obsolete system of making the bike stable by using aditional invisible wheels
        - RightHelprWheel:      # ^
      - LeftHelperRotator:      # ^
        - LeftHelperWheel:      # ^
      - Seat:                   # Sets the position of the drivers hip bone. No need to bind it to anything but place it carefully.
</code></pre>
<p><strong>1.</strong> Import fbx as Skelletal Mesh to its own folder inside <code>Content/Carla/Static/Vehicles/2Wheeled</code>. When importing select "General2WheeledVehicleSkeleton" as skelleton A Physics asset should be automatically created and linked.  </p>
<p><strong>2.</strong> Tune the Physics asset. Delete the automatically created ones and add boxes to the <code>BikeBody</code> bone trying to match the shape as possible, make sure generate hit events is enabled. 
  Add a sphere for each wheel and set their "Physics Type" to "Kinematic".  </p>
<p><strong>3.</strong> Create folder <code>Content/Blueprints/Vehicles/&lt;vehicle-model&gt;</code>  </p>
<p><strong>4.</strong> Inside that folder create two blueprint classes derived from "VehicleWheel" class. Call them <code>&lt;vehicle-model&gt;_FrontWheel</code> and <code>&lt;vehicle-model&gt;_RearWheel</code>. Set their "Shape Radius" to exactly match the mesh wheel radius (careful, radius not diameter). Set their "Tire Config" to "CommonTireConfig". On the front wheel uncheck "Affected by Handbrake" and on the rear wheel set "Steer Angle" to zero.  </p>
<p><strong>5.</strong> Inside the same folder create a blueprint class derived from <code>Base2WheeledVehicle</code> call it <code>&lt;vehicle-model&gt;</code>. Open it for edit and select component "Mesh", setup the "Skeletal Mesh"
  and the "Anim Class" to the corresponding ones. Then select the VehicleBounds component and set the size to cover vehicle's area as seen from above.</p>
<p><strong>6.</strong> Select component "VehicleMovement", under "Vehicle Setup" expand "Wheel Setups", setup each wheel.  </p>
<ul>
<li><strong>0:</strong> Wheel Class=<code>&lt;vehicle-model&gt;_FrontWheel</code>, Bone Name=<code>FrontWheel</code>  </li>
<li><strong>1:</strong> Wheel Class=<code>&lt;vehicle-model&gt;_FrontWheel</code>, Bone Name=<code>FrontWheel</code>  </li>
<li><strong>2:</strong> Wheel Class=<code>&lt;vehicle-model&gt;_RearWheel</code>, Bone Name=<code>RearWheel</code>  </li>
<li><strong>3:</strong> Wheel Class=<code>&lt;vehicle-model&gt;_RearWheel</code>, Bone Name=<code>RearWheel</code><br />
  (You'll notice that we are basically placing two wheels in each bone. The vehicle class unreal provides does not support vehicles with wheel numbers different from 4 so we had to make it believe the vehicle has 4 wheels)</li>
</ul>
<p><strong>7.</strong> Select the variable "is bike" and tick it if your model is a bike. This will activate the
  pedalier rotation. Leave unmarked if you are setting up a motorbike.</p>
<p><strong>8.</strong> Find the variable back Rotation and set it as it fit better select the component SkeletalMesh
  (The driver) and move it along x axis until its in the seat position.  </p>
<p><strong>9.</strong> Test it, go to CarlaGameMode blueprint and change "Default Pawn Class" to the newly
  created bike blueprint.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../build_docker_unreal/" class="btn btn-neutral float-left" title="在 Docker 中构建虚幻引擎和 Carla"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../tuto_A_add_props/" class="btn btn-neutral float-right" title="添加新道具">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../build_docker_unreal/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../tuto_A_add_props/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../extra.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
